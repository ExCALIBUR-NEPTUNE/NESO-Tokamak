<?xml version="1.0" encoding="utf-8" ?>
<NEKTAR>
    <!--
        The composite index for the domain is expected to be 0 if the mesh was generated from the included .geo file
     -->
    <EXPANSIONS>
       <E COMPOSITE="C[0]" NUMMODES="4" TYPE="MODIFIED" FIELDS="n,v,e," />
    </EXPANSIONS>

    <CONDITIONS>
        <SOLVERINFO>
            <I PROPERTY="EQTYPE"                       VALUE="ReducedBraginskii"/>
            <I PROPERTY="Projection"                   VALUE="DisContinuous" />
            <I PROPERTY="UpwindType"                   VALUE="MultiFieldUpwind"        />
            <I PROPERTY="DiffusionAdvancement"         VALUE="Implicit"/>
            <I PROPERTY="AdvectionType"                VALUE="WeakDG"/>
        </SOLVERINFO>
        <TIMEINTEGRATIONSCHEME>
            <METHOD> DIRK </METHOD>
            <ORDER> 2 </ORDER>
        </TIMEINTEGRATIONSCHEME>

        <GLOBALSYSSOLNINFO>
            <V VAR="n,v,e,phi,omega">
                <I PROPERTY="GlobalSysSoln"             VALUE="XxtMultiLevelStaticCond"/>
                <I PROPERTY="LinSysIterSolver"          VALUE="GMRES"/>
                <I PROPERTY="Preconditioner"            VALUE="Diagonal"        />
                <I PROPERTY="MaxIterations"             VALUE="1000"/>
                <I PROPERTY="GMRESMaxStorage"           VALUE=200       />
                <I PROPERTY="IterativeSolverTolerance"  VALUE="1e-6"/>
            </V>
        </GLOBALSYSSOLNINFO>

        <PARAMETERS>
            <!-- Timestepping and output options -->
            <P> TimeStep      = 0.0005            </P>
            <P> NumSteps      = 200              </P>
            <P> TFinal        = NumSteps*TimeStep </P>
            <P> IO_InfoSteps  = 1     </P>
            <P> IO_CheckSteps = 1     </P>
            <P> particle_output_freq = 1          </P>
            <P> NekNonlinSysMaxIterations = 30       </P>


            <P> epsilon         = 1.0   </P>
            <!-- Anisotropic diffusion -->
            <P> k_par           = 0   </P>
            <P> k_perp          = 0.1   </P>
            <P> kappa_par           = 0   </P>
            <P> kappa_perp          = 0.0   </P>
            <P> TCore           = 300.0 </P>
            <P> T_bnd            = 1.0 </P>
            <P> k_B             = 1.0 </P>
            <P> m_i             = 1.0 </P>

            <!-- Scaling factor for ICs -->
            <P> rc = 2 </P>
            <P> ri = 0.5 </P>
            <P> ro = 1 </P>
            <P> yc = 0 </P>                     
            <P> rs = 0.75 </P>
            <P> ys = 0 </P>
            <P> sr = 0.1 </P>
            <P> sy = 0.1 </P>

            <P> num_particles_total = 0 </P>
        </PARAMETERS>

        <VARIABLES>
            <V ID="0"> n  </V>
            <V ID="1"> v  </V>
            <V ID="2"> e  </V>
        </VARIABLES>

        <BOUNDARYREGIONS>
            <B ID="1"> C[1] </B> <!-- Inner -->
            <B ID="2"> C[2] </B> <!-- Outer -->
        </BOUNDARYREGIONS>

        <BOUNDARYCONDITIONS>
            <REGION REF="1">
                <N VAR="n"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <D VAR="v"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <N VAR="e"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <!-- <N VAR="n"   VALUE="0.0" />
                <N VAR="v"   VALUE="0.0" />
                <N VAR="e"   VALUE="0.0" /> -->
            </REGION>
            <REGION REF="2">
                <N VAR="n"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <D VAR="v"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <N VAR="e"   USERDEFINEDTYPE="Sheath" VALUE="0.0" />
                <!-- <N VAR="n"   VALUE="0.0" />
                <N VAR="v"   VALUE="0.0" />
                <N VAR="e"   VALUE="0.0" /> -->
            </REGION>
        </BOUNDARYCONDITIONS>
        <FUNCTION NAME="InitialConditions">
            <E VAR="n"  DOMAIN="0" VALUE="0" />
            <E VAR="v"  DOMAIN="0" VALUE="0" />
            <!-- <E VAR="e"  DOMAIN="0" VALUE="1+0.01*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" /> -->
            <E VAR="e"  DOMAIN="0" VALUE="1+0.01*sin(5*2*PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*sin(16*ang(x-rc, y-yc))" />
        </FUNCTION>
        <FUNCTION NAME="MagneticField">
            <E VAR="Bx" VALUE="(y-yc)/sqrt((x-rc)*(x-rc)+(y-yc)*(y-yc))" />
            <E VAR="By" VALUE="-(x-rc)/sqrt((x-rc)*(x-rc)+(y-yc)*(y-yc))" />
            <E VAR="Bz" VALUE="10" />
        </FUNCTION>
    </CONDITIONS>
    <NESO>
        <SPECIES>
            <S ID="0" NAME="D">
                <P> Mass = 1.0 </P>
                <P> Charge = 1.0 </P>
                <FUNCTION NAME="InitialConditions">
                    <!-- <E VAR="n"  DOMAIN="0" VALUE="1+0.01*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" /> -->
                    <E VAR="n"  DOMAIN="0" VALUE="1+0.01*sin(4*2*PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*sin(16*ang(x-rc, y-yc))" />
                    <E VAR="v"  DOMAIN="0" VALUE="100*sin(PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*(1+0.01*sin(4*2*PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*sin(16*ang(x-rc, y-yc))) " />
                    <!-- <E VAR="v"  DOMAIN="0" VALUE="100" /> -->
                    <!-- <E VAR="v"  DOMAIN="0" VALUE="10*sin(5*2*PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*sin(11*ang(x-rc, y-yc))" /> -->
                    <!-- <E VAR="e"  DOMAIN="0" VALUE="1+0.01*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" /> -->
                    <E VAR="e"  DOMAIN="0" VALUE="1+0.01*sin(5*2*PI*(sqrt((x-rc)^2+(y-yc)^2)-ri)/(ro-ri))*sin(16*ang(x-rc, y-yc))" />
                    <!-- <E VAR="e"  DOMAIN="0" VALUE="1+0.01*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" /> -->
                </FUNCTION>
            </S>
        </SPECIES> 
    </NESO>
</NEKTAR>
