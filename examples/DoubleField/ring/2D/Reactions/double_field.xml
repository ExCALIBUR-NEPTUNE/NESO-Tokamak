<?xml version="1.0" encoding="utf-8" ?>
<NEKTAR>

    <COLLECTIONS DEFAULT="MatrixFree" />

    <!--
        The composite index for the domain is expected to be 0 if the mesh was generated from the included .geo file
     -->
    <EXPANSIONS>
       <E COMPOSITE="C[0]" NUMMODES="4" TYPE="MODIFIED" FIELDS="n,e" />
    </EXPANSIONS>

    <CONDITIONS>
        <SOLVERINFO>
            <I PROPERTY="EQTYPE"                       VALUE="DoubleDiffusiveField"/>
            <I PROPERTY="Projection"                   VALUE="Continuous" />
            <I PROPERTY="TimeIntegrationMethod"        VALUE="IMEXOrder2"    />
            <!-- <I PROPERTY="LinSysIterSolverTypeInNonlin" VALUE="GMRES"         /> -->
            <!-- <I PROPERTY="UpwindType"                   VALUE="Upwind"        /> -->
            <I PROPERTY="DiffusionAdvancement"          VALUE="Implicit"/>
        </SOLVERINFO>

        <PARAMETERS>
            <!-- Timestepping and output options -->
            <P> TimeStep      = 0.05            </P>
            <P> NumSteps      = 50              </P>
            <P> TFinal        = NumSteps*TimeStep </P>
            <P> IO_InfoSteps  = 10     </P>
            <P> IO_CheckSteps = 10     </P>
            <P> particle_output_freq = 1          </P>

            <P> epsilon         = 1.0   </P>
            <!-- Anisotropic diffusion -->
            <P> k_par           = 1e-2   </P>
            <P> k_perp          = 1e-8   </P>
            <P> TCore           = 300.0 </P>
            <P> T_bnd            = 1.0 </P>
            <P> k_B             = 1.0 </P>
            <P> m_i             = 1.0 </P>

            <!-- Scaling factor for ICs -->
            <P> rc = 2 </P>
            <P> yc = 0 </P>                     
            <P> rs = 0.75 </P>
            <P> ys = 0 </P>
            <P> sr = 0.1 </P>
            <P> sy = 0.1 </P>
            
            <!-- Implicit solve params -->
            <P> IterativeSolverTolerance  = 1.0E-8  </P>
            <P> NekNonlinSysMaxIterations = 30       </P>
            <P> NewtonRelativeIteTol      = 1.0E-10  </P>
            <P> NonlinIterTolRelativeL2   = 1.0E-10  </P>
            <P> LinSysRelativeTolInNonlin = 1.0E-02  </P>

            <P> num_particles_total = 1 </P>
        </PARAMETERS>

        <VARIABLES>
            <V ID="0"> n  </V>
            <V ID="1"> e  </V>
        </VARIABLES>

        <BOUNDARYREGIONS>
            <B ID="1"> C[1] </B> <!-- Inner -->
            <B ID="2"> C[2] </B> <!-- Outer -->
        </BOUNDARYREGIONS>
        <BOUNDARYCONDITIONS>
            <REGION REF="1">
                <N VAR="n"  VALUE="0.0" />
                <N VAR="e"  VALUE="0.0" />
            </REGION>
            <REGION REF="2">
                <N VAR="n"  VALUE="0.0" />
                <N VAR="e"  VALUE="0.0" />
            </REGION>
        </BOUNDARYCONDITIONS>

        <FUNCTION NAME="InitialConditions">
            <E VAR="n"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" />
            <E VAR="e"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" />
        </FUNCTION>
        <FUNCTION NAME="MagneticField">
            <E VAR="Bx" VALUE="(y-yc)/sqrt((x-rc)*(x-rc)+(y-yc)*(y-yc))" />
            <E VAR="By" VALUE="-(x-rc)/sqrt((x-rc)*(x-rc)+(y-yc)*(y-yc))" />
            <E VAR="Bz" VALUE="0" />
        </FUNCTION>
    </CONDITIONS>

    <NESO>
        <SPECIES>
            <S ID="0" NAME="D">
                <P> Mass = 2.0 </P>
                <P> Charge = 1.0 </P>
                <FUNCTION NAME="InitialConditions">
                    <E VAR="n"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc-rs)*(x-rc-rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" />
                    <E VAR="e"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc)*(x-rc)/(2*sr*sr))+(-(y-yc+0.75)*(y-yc+0.75)/(2*sy*sy)))" />
                </FUNCTION>
            </S>
            <S ID="1" NAME="T">
                <P> Mass = 3.0 </P>
                <P> Charge = 1.0 </P>
                <FUNCTION NAME="InitialConditions">
                    <E VAR="n"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc+rs)*(x-rc+rs)/(sr*sr))+(-(y-yc-ys)*(y-yc-ys)/(sy*sy)))" />
                    <E VAR="e"  DOMAIN="0" VALUE="0.1+0.1*exp((-(x-rc)*(x-rc)/(2*sr*sr))+(-(y-yc-0.75)*(y-yc-0.75)/(2*sy*sy)))" />
                </FUNCTION>
            </S>
        </SPECIES> 
        <PARTICLES>
            <INFO>
                <I PROPERTY="PARTTYPE" VALUE="ReactionSystem"/>
            </INFO>
            <PARAMETERS>
                <P> particle_output_freq = 1          </P>
                <P> particle_v_drift_scaling = 1.0 </P>
                <P> particle_B_scaling = 1.0 </P>
                <P> particle_velocity_B_scaling = 0.0 </P>
                <P> particle_thermal_velocity = 0.1  </P>
            </PARAMETERS>   

            <SPECIES>
                <S ID="0" NAME="D">
                    <P> Mass = 2.0 </P>
                    <P> Charge = 1.0 </P>
                    <INITIAL N="1000">
                        <E VAR="n" VALUE="sin(4*x)*sin(4*x)"/>
                    </INITIAL>
                    <!-- <SOURCE N="100">
                        <E VAR="n" VALUE="exp((-(x-2-0.75*cos(150*t))*(x-2-0.75*cos(150*t))/(0.01))+(-(y-0.75*sin(150*t))*(y-0.75*sin(150*t))/(0.01)))"/>
                    </SOURCE>
                    <SINK>
                        <E VAR="n" VALUE="exp((-(x-2-0.75*sin(150*t))*(x-2-0.75*sin(150*t))/(0.01))+(-(y+0.75*cos(150*t))*(y+0.75*cos(150*t))/(0.01)))"/>
                    </SINK> -->
                    <BOUNDARYINTERACTION>
                        <REGION REF="1">
                            <C VALUE="0.0" />
                        </REGION>   
	                    <REGION REF="2">
                            <C VALUE="0.0" />
                        </REGION>
                    </BOUNDARYINTERACTION> 
                </S>
                <S ID="1" NAME="T">
                    <P> Mass = 3.0 </P>
                    <P> Charge = 1.0 </P>
                    <INITIAL N="1000">
                        <E VAR="n" VALUE="cos(4*x)*cos(4*x)"/>
                    </INITIAL>
                    <!-- <SOURCE N="100">
                        <E VAR="n" VALUE="exp((-(x-2+0.75*cos(150*t))*(x-2+0.75*cos(150*t))/(0.01))+(-(y+0.75*sin(150*t))*(y+0.75*sin(150*t))/(0.01)))"/>
                    </SOURCE>
                    <SINK>
                        <E VAR="n" VALUE="exp((-(x-2+0.75*sin(150*t))*(x-2+0.75*sin(150*t))/(0.01))+(-(y-0.75*cos(150*t))*(y-0.75*cos(150*t))/(0.01)))"/>
                    </SINK> -->
                    <BOUNDARYINTERACTION>
                        <REGION REF="1">
                            <C VALUE="0.0" />
                        </REGION>   
	                    <REGION REF="2">
                            <C VALUE="0.0" />
                        </REGION>
                    </BOUNDARYINTERACTION> 
                </S>
            </SPECIES>  

            <REACTIONS>
                <R ID="0" TYPE="Ionisation" SPECIES="0">
                    <RATE TYPE="AMJUEL" VALUE="1.0"/>
                    <CROSSSECTION TYPE="Constant" VALUE="1.0"/>
                </R>
                <R ID="1" TYPE="Ionisation" SPECIES="1">
                    <RATE TYPE="AMJUEL" VALUE="1.0"/>
                    <CROSSSECTION TYPE="Constant" VALUE="1.0"/>
                </R>
                <R ID="2" TYPE="Recombination" SPECIES="0">
                    <RATE TYPE="AMJUEL" VALUE="1.0"/>
                    <CROSSSECTION TYPE="Constant" VALUE="1.0"/>
                </R>
                <R ID="3" TYPE="Recombination" SPECIES="1">
                    <RATE TYPE="AMJUEL" VALUE="1.0"/>
                    <CROSSSECTION TYPE="Constant" VALUE="1.0"/>
                </R>
                <R ID="4" TYPE="ChargeExchange" SPECIES="0,1">
                    <RATE TYPE="AMJUEL" VALUE="1.0"/>
                    <CROSSSECTION TYPE="Constant" VALUE="1.0"/>
                </R>
                
            </REACTIONS>    

        </PARTICLES>
    </NESO>
</NEKTAR>
