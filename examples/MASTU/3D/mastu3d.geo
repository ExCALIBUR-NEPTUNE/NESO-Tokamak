cl__1 = 0.5;
cl__2 = 0.1;
Point(1) = {0.8910177759, -0.007728051121, 0, cl__1};
Point(2) = {0.5086728, -1.290643137636172, 0, cl__1};
Point(3) = {0.5086728, 1.291605154047678, 0, cl__1};
Point(4) = {0.5608475700000001, -1.259936857315194, 0, cl__2};
Point(5) = {0.61302234, -1.230688922389276, 0, cl__2};
Point(6) = {0.6738929050000002, -1.194476265583196, 0, cl__2};
Point(7) = {0.726067675, -1.161379689188565, 0, cl__2};
Point(8) = {0.7782424450000001, -1.124219915964076, 0, cl__2};
Point(9) = {0.8304172150000001, -1.081449785896832, 0, cl__2};
Point(10) = {0.8825919850000001, -1.031311500140313, 0, cl__2};
Point(11) = {0.9314460192184018, -0.97633875, 0, cl__2};
Point(12) = {0.97824573, -0.9177965355162594, 0, cl__2};
Point(13) = {1.021724705, -0.8592664104091889, 0, cl__2};
Point(14) = {1.06520368, -0.797724282171083, 0, cl__2};
Point(15) = {1.108682655, -0.7329905267163442, 0, cl__2};
Point(16) = {1.15216163, -0.6627293776313969, 0, cl__2};
Point(17) = {1.193025246101962, -0.58694925, 0, cl__2};
Point(18) = {1.230423785, -0.5008463047986336, 0, cl__2};
Point(19) = {1.259821013995905, -0.4138872499999999, 0, cl__2};
Point(20) = {1.289610629565509, -0.3057235, 0, cl__2};
Point(21) = {1.315312470858295, -0.1975597499999999, 0, cl__2};
Point(22) = {1.334773325, -0.08521641525571637, 0, cl__2};
Point(23) = {1.335003644974553, 0.08366600000000002, 0, cl__2};
Point(24) = {1.316543813262543, 0.1918297500000001, 0, cl__2};
Point(25) = {1.29107734792677, 0.2999934999999998, 0, cl__2};
Point(26) = {1.26155572378685, 0.4081572499999999, 0, cl__2};
Point(27) = {1.230423785, 0.5008002247710589, 0, cl__2};
Point(28) = {1.195640605, 0.5815916129568819, 0, cl__2};
Point(29) = {1.15216163, 0.662726452836257, 0, cl__2};
Point(30) = {1.108897003822435, 0.7326484999999998, 0, cl__2};
Point(31) = {1.065297402428984, 0.79754675, 0, cl__2};
Point(32) = {1.021724705, 0.8592154534594005, 0, cl__2};
Point(33) = {0.9782457300000001, 0.9178135338450892, 0, cl__2};
Point(34) = {0.9347667550000001, 0.9724640776326393, 0, cl__2};
Point(35) = {0.8825919850000001, 1.031245536198318, 0, cl__2};
Point(36) = {0.8332855019373022, 1.0787725, 0, cl__2};
Point(37) = {0.7808915859788772, 1.122038, 0, cl__2};
Point(38) = {0.726067675, 1.161281264684611, 0, cl__2};
Point(39) = {0.6738929050000001, 1.194677364408616, 0, cl__2};
Point(40) = {0.6132117455310759, 1.23020175, 0, cl__2};
Point(41) = {0.5608475700000001, 1.260502126952293, 0, cl__2};
Point(42) = {0.4762971037403617, 1.23020175, 0, cl__2};
Point(43) = {0.43910644, 1.143935839309544, 0, cl__2};
Point(44) = {0.4135517143839593, 1.035507, 0, cl__2};
Point(45) = {0.4003060436105522, 0.9057105000000001, 0, cl__2};
Point(46) = {0.3912089986737363, 0.75428125, 0, cl__2};
Point(47) = {0.383033539094059, 0.6028519999999999, 0, cl__2};
Point(48) = {0.3739777169168694, 0.4514227499999999, 0, cl__2};
Point(49) = {0.3657464261968274, 0.2999934999999998, 0, cl__2};
Point(50) = {0.3601733394151698, 0.1485642500000001, 0, cl__2};
Point(51) = {0.3583103503903948, -0.0244977500000001, 0, cl__2};
Point(52) = {0.3609340384899613, -0.1759269999999999, 0, cl__2};
Point(53) = {0.368210132581216, -0.348989, 0, cl__2};
Point(54) = {0.376939103757479, -0.5004182500000001, 0, cl__2};
Point(55) = {0.3857879900020798, -0.6518474999999999, 0, cl__2};
Point(56) = {0.3938715696813402, -0.80327675, 0, cl__2};
Point(57) = {0.4042396997197801, -0.9547060000000001, 0, cl__2};
Point(58) = {0.42171485, -1.080451269171617, 0, cl__2};
Point(59) = {0.4490013625328367, -1.1710335, 0, cl__2};
Point(60) = {0.5086728, -1.290643137636172, 0, cl__2};
Point(61) = {0.42171485, -1.350866365747712, 0, cl__2};
Point(62) = {0.3983426823433181, -1.370738257265755, 0, cl__2};
Point(63) = {0.5086728, -1.290643137636172, 0, cl__2};
Point(64) = {0.5815075318039973, -1.40899375, 0, cl__2};
Point(65) = {0.6233278151263635, -1.473892, 0, cl__2};
Point(66) = {0.669464046460287, -1.53879025, 0, cl__2};
Point(67) = {0.7173718800000001, -1.595670837070851, 0, cl__2};
Point(68) = {0.7695466500000001, -1.646057058376831, 0, cl__2};
Point(69) = {0.82172142, -1.68321122606532, 0, cl__2};
Point(70) = {0.8767469391467152, -1.71185225, 0, cl__2};
Point(71) = {0.9347667550000001, -1.736346411226698, 0, cl__2};
Point(72) = {0.9956373200000002, -1.760292955050955, 0, cl__2};
Point(73) = {1.056507885, -1.785524491573309, 0, cl__2};
Point(74) = {1.11737845, -1.813885369218514, 0, cl__2};
Point(75) = {1.170119939300404, -1.84164875, 0, cl__2};
Point(76) = {1.230423785, -1.876861372581502, 0, cl__2};
Point(77) = {1.282598555, -1.907162468233006, 0, cl__2};
Point(78) = {1.34346912, -1.937741193340516, 0, cl__2};
Point(79) = {1.404339685, -1.956055656184758, 0, cl__2};
Point(80) = {1.454102939682652, -1.958657741722237, 0, cl__2};
Point(81) = {0.5086728, 1.291605154047678, 0, cl__2};
Point(82) = {0.5779448384742235, 1.40326375, 0, cl__2};
Point(83) = {0.6195277082203132, 1.468162, 0, cl__2};
Point(84) = {0.6651446605032802, 1.53306025, 0, cl__2};
Point(85) = {0.7086760850000001, 1.586012378052574, 0, cl__2};
Point(86) = {0.7608508549999999, 1.638610105682208, 0, cl__2};
Point(87) = {0.8130256250000001, 1.677825853006138, 0, cl__2};
Point(88) = {0.8652003950000001, 1.70645378645413, 0, cl__2};
Point(89) = {0.9260709600000001, 1.732900497772941, 0, cl__2};
Point(90) = {0.986941525, 1.756876358873699, 0, cl__2};
Point(91) = {1.04781209, 1.781768648675893, 0, cl__2};
Point(92) = {1.108682655, 1.809565476504442, 0, cl__2};
Point(93) = {1.160857425, 1.836553027099431, 0, cl__2};
Point(94) = {1.22172799, 1.871690588134171, 0, cl__2};
Point(95) = {1.27390276, 1.902266019023239, 0, cl__2};
Point(96) = {1.334773325, 1.933989711698868, 0, cl__2};
Point(97) = {1.39564389, 1.954435103571824, 0, cl__2};
Point(98) = {1.450134924418512, 1.958865728041662, 0, cl__2};
Point(99) = {0.5086728, 1.291605154047678, 0, cl__2};
Point(100) = {0.413019055, 1.358320000437885, 0, cl__2};
Point(101) = {0.4013391513962811, 1.367935755328997, 0, cl__2};
Point(102) = {1.56442, 1.56424, 0, cl__1};
Point(103) = {1.73298, 1.67902, 0, cl__1};
Point(104) = {1.34848, 2.06041, 0, cl__1};
Point(105) = {1.0882, 2.05946, 0, cl__1};
Point(106) = {0.902253, 1.87565, 0, cl__1};
Point(107) = {0.9036689999999999, 1.87424, 0, cl__1};
Point(108) = {0.533866, 1.50286, 0, cl__1};
Point(109) = {0.538011, 1.49874, 0, cl__1};
Point(110) = {0.332797, 1.29709, 0, cl__1};
Point(111) = {0.332797, 1.094, 0, cl__1};
Point(112) = {0.334796, 1.094, 0, cl__1};
Point(113) = {0.303115, 0.8475, 0, cl__1};
Point(114) = {0.305114, 0.8475, 0, cl__1};
Point(115) = {0.269136, 0.5649999999999999, 0, cl__1};
Point(116) = {0.271135, 0.5649999999999999, 0, cl__1};
Point(117) = {0.260841, 0.495258, 0, cl__1};
Point(118) = {0.260841, 0.244629, 0, cl__1};
Point(119) = {0.260841, -0.006000000000000005, 0, cl__1};
Point(120) = {0.260841, -0.256629, 0, cl__1};
Point(121) = {0.260841, -0.507258, 0, cl__1};
Point(122) = {0.271135, -0.577, 0, cl__1};
Point(123) = {0.269136, -0.577, 0, cl__1};
Point(124) = {0.305114, -0.8595, 0, cl__1};
Point(125) = {0.303115, -0.8595, 0, cl__1};
Point(126) = {0.334796, -1.106, 0, cl__1};
Point(127) = {0.332797, -1.106, 0, cl__1};
Point(128) = {0.332797, -1.30909, 0, cl__1};
Point(129) = {0.538598, -1.5099, 0, cl__1};
Point(130) = {0.534469, -1.51403, 0, cl__1};
Point(131) = {0.90563, -1.88406, 0, cl__1};
Point(132) = {0.904219, -1.88547, 0, cl__1};
Point(133) = {1.0882, -2.06614, 0, cl__1};
Point(134) = {1.34848, -2.06519, 0, cl__1};
Point(135) = {1.73018, -1.68099, 0, cl__1};
Point(136) = {1.56442, -1.56884, 0, cl__1};
Point(137) = {1.37999, -1.57688, 0, cl__1};
Point(138) = {1.37989, -1.57673, 0, cl__1};
Point(139) = {1.19622, -1.58475, 0, cl__1};
Point(140) = {0.899473, -1.30018, 0, cl__1};
Point(141) = {1.18568, -1.0138, 0, cl__1};
Point(142) = {1.279, -0.8423, 0, cl__1};
Point(143) = {1.296, -0.8202, 0, cl__1};
Point(144) = {1.521, -0.8202, 0, cl__1};
Point(145) = {1.521, -0.25, 0, cl__1};
Point(146) = {1.8, -0.25, 0, cl__1};
Point(147) = {1.8, 0.25, 0, cl__1};
Point(148) = {1.521, 0.25, 0, cl__1};
Point(149) = {1.521, 0.8156, 0, cl__1};
Point(150) = {1.296, 0.8156, 0, cl__1};
Point(151) = {1.279, 0.8377, 0, cl__1};
Point(152) = {1.18568, 1.0092, 0, cl__1};
Point(153) = {0.899473, 1.29558, 0, cl__1};
Point(154) = {1.19622, 1.58015, 0, cl__1};
Point(155) = {1.37989, 1.57213, 0, cl__1};
Point(156) = {1.37999, 1.57228, 0, cl__1};
Point(157) = {1.56442, 1.56424, 0, cl__1};
Line(1) = {2, 4};
Line(2) = {4, 5};
Line(3) = {5, 6};
Line(4) = {6, 7};
Line(5) = {7, 8};
Line(6) = {8, 9};
Line(7) = {9, 10};
Line(8) = {10, 11};
Line(9) = {11, 12};
Line(10) = {12, 13};
Line(11) = {13, 14};
Line(12) = {14, 15};
Line(13) = {15, 16};
Line(14) = {16, 17};
Line(15) = {17, 18};
Line(16) = {18, 19};
Line(17) = {19, 20};
Line(18) = {20, 21};
Line(19) = {21, 22};
Line(20) = {22, 23};
Line(21) = {23, 24};
Line(22) = {24, 25};
Line(23) = {25, 26};
Line(24) = {26, 27};
Line(25) = {27, 28};
Line(26) = {28, 29};
Line(27) = {29, 30};
Line(28) = {30, 31};
Line(29) = {31, 32};
Line(30) = {32, 33};
Line(31) = {33, 34};
Line(32) = {34, 35};
Line(33) = {35, 36};
Line(34) = {36, 37};
Line(35) = {37, 38};
Line(36) = {38, 39};
Line(37) = {39, 40};
Line(38) = {40, 41};
Line(39) = {41, 3};
Line(40) = {3, 42};
Line(41) = {42, 43};
Line(42) = {43, 44};
Line(43) = {44, 45};
Line(44) = {45, 46};
Line(45) = {46, 47};
Line(46) = {47, 48};
Line(47) = {48, 49};
Line(48) = {49, 50};
Line(49) = {50, 51};
Line(50) = {51, 52};
Line(51) = {52, 53};
Line(52) = {53, 54};
Line(53) = {54, 55};
Line(54) = {55, 56};
Line(55) = {56, 57};
Line(56) = {57, 58};
Line(57) = {58, 59};
Line(58) = {59, 2};
Line(59) = {60, 61};
Line(60) = {61, 62};
Line(61) = {63, 64};
Line(62) = {64, 65};
Line(63) = {65, 66};
Line(64) = {66, 67};
Line(65) = {67, 68};
Line(66) = {68, 69};
Line(67) = {69, 70};
Line(68) = {70, 71};
Line(69) = {71, 72};
Line(70) = {72, 73};
Line(71) = {73, 74};
Line(72) = {74, 75};
Line(73) = {75, 76};
Line(74) = {76, 77};
Line(75) = {77, 78};
Line(76) = {78, 79};
Line(77) = {79, 80};
Line(78) = {81, 82};
Line(79) = {82, 83};
Line(80) = {83, 84};
Line(81) = {84, 85};
Line(82) = {85, 86};
Line(83) = {86, 87};
Line(84) = {87, 88};
Line(85) = {88, 89};
Line(86) = {89, 90};
Line(87) = {90, 91};
Line(88) = {91, 92};
Line(89) = {92, 93};
Line(90) = {93, 94};
Line(91) = {94, 95};
Line(92) = {95, 96};
Line(93) = {96, 97};
Line(94) = {97, 98};
Line(95) = {99, 100};
Line(96) = {100, 101};
Line(97) = {102, 103};
Line(98) = {103, 104};
Line(99) = {104, 105};
Line(100) = {105, 106};
Line(101) = {106, 107};
Line(102) = {107, 108};
Line(103) = {108, 109};
Line(104) = {109, 110};
Line(105) = {110, 111};
Line(106) = {111, 112};
Line(107) = {112, 113};
Line(108) = {113, 114};
Line(109) = {114, 115};
Line(110) = {115, 116};
Line(111) = {116, 117};
Line(112) = {117, 118};
Line(113) = {118, 119};
Line(114) = {119, 120};
Line(115) = {120, 121};
Line(116) = {121, 122};
Line(117) = {122, 123};
Line(118) = {123, 124};
Line(119) = {124, 125};
Line(120) = {125, 126};
Line(121) = {126, 127};
Line(122) = {127, 128};
Line(123) = {128, 129};
Line(124) = {129, 130};
Line(125) = {130, 131};
Line(126) = {131, 132};
Line(127) = {132, 133};
Line(128) = {133, 134};
Line(129) = {134, 135};
Line(130) = {135, 136};
Line(131) = {136, 137};
Line(132) = {137, 138};
Line(133) = {138, 139};
Line(134) = {139, 140};
Line(135) = {140, 141};
Line(136) = {141, 142};
Line(137) = {142, 143};
Line(138) = {143, 144};
Line(139) = {144, 145};
Line(140) = {145, 146};
Line(141) = {146, 147};
Line(142) = {147, 148};
Line(143) = {148, 149};
Line(144) = {149, 150};
Line(145) = {150, 151};
Line(146) = {151, 152};
Line(147) = {152, 153};
Line(148) = {153, 154};
Line(149) = {154, 155};
Line(150) = {155, 156};
Line(151) = {156, 102};
Curve Loop(1) = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58};
Curve Loop(2) = {97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, -58, -57, -56, -55, -54, -53, -52, -51, -50, -49, -48, -47, -46, -45, -44, -43, -42, -41, -40, -39, -38, -37, -36, -35, -34, -33, -32, -31, -30, -29, -28, -27, -26, -25, -24, -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1};
// Physical Point("X0") = {1};
// Physical Point("X-point0") = {2};
// Physical Point("X-point1") = {3};
// Physical Curve("CorePol") = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58};
// Physical Curve("SepPol0") = {59, 60};
// Physical Curve("SepPol1") = {61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77};
// Physical Curve("SepPol2") = {78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94};
// Physical Curve("SepPol3") = {95, 96};
// Physical Curve("Wall") = {97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151};

Plane Surface(1) = {1};
Plane Surface(2) = {2};
// Physical Surface("Core") = {1};
// Physical Surface("Poloidal") = {2};
Field[1] = Distance;
Field[1].EdgesList = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94};
Field[1].FieldX = 0;
Field[1].FieldY = 0;
Field[1].FieldZ = 0;
Field[1].NNodesByEdge = 20;
Field[1].NumPointsPerCurve = 20;
Field[1].Sampling = 20;
Field[2] = Threshold;
Field[2].DistMax = 0.8;
Field[2].DistMin = 0.02;
Field[2].IField = 1;
Field[2].InField = 1;
Field[2].LcMax = 1;
Field[2].LcMin = 0.02;
Field[2].Sigmoid = 0;
Field[2].SizeMax = 1;
Field[2].SizeMin = 0.02;
Field[2].StopAtDistMax = 0;
Field[3] = Min;
Field[3].FieldsList = {2};
Background Field = 3;
Mesh.MeshSizeExtendFromBoundary = 0;
Mesh.MeshSizeFromPoints = 0;
Mesh.MeshSizeFromCurvature = 0;

Physical Volume("Core") = {};
Physical Volume("Poloidal") = {};
Physical Surface("Seperatrix") = {};
Physical Surface("Wall") = {};

s1 = 1;
s2 = 2;
ntor = 24;

// Gmsh can only rotate about an angle less than Pi, so need to do this in multiple steps.
For num In {1:4}
    core_out[] = Extrude { {0, 1, 0}, {0, 0, 0}, Pi/2 } {
        Surface{s1}; Layers{ntor/4}; Recombine;
    };
    s1 = core_out[0];
    Physical Volume("Core") += core_out[1];
    For j In {2:#core_out[] - 1}
        Physical Surface("Seperatrix") += core_out[j];
    EndFor
    
    pol_out[] = Extrude { {0, 1, 0}, {0, 0, 0}, Pi/2 } {
        Surface{s2}; Layers{ntor/4}; Recombine;
    };
    s2 = pol_out[0];
    Physical Volume("Poloidal") += pol_out[1];
    wall[num - 1] = pol_out[2];
    For j In {2:#pol_out[] - 1}
        Physical Surface("Wall") += pol_out[j];
        // Need to remove the seperatrix items, somehow
    EndFor
    For j In {2:#core_out[] - 1}
        Physical Surface("Wall") -= core_out[j];
    EndFor
    
EndFor

Coherence;
